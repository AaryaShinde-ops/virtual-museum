<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Virtual Museum</title>
        <style>
            body { margin: 0; padding: 0}
            canvas { display: block; }
        </style>

        <script id='vert' type='x-shader/x-vertex'>
        // Note: Other uniform declarations like modelViewMatrix are
        // prepended to these shaders

        varying vec3 fPositionView;
        varying vec3 fNormalView;

        void main() {
            fPositionView = vec3(modelViewMatrix * vec4(position, 1.0));
            fNormalView = vec3(modelViewMatrix * vec4(normal, 0.0));
            gl_Position = projectionMatrix * vec4(fPositionView, 1.0);
        }
        </script>

        <script id='frag' type='x-shader/x-fragment'>
        struct PointLight {
            vec3 color;
            vec3 position; // in view space
            float distance;
        };

        uniform float time;

        uniform PointLight pointLights[NUM_POINT_LIGHTS];

        varying vec3 fPositionView;
        varying vec3 fNormalView;

        void main() {
            vec3 N = normalize(fNormalView);

            vec3 color = vec3(0.0);

            // Simple Lambert shading
            for (int i = 0; i < NUM_POINT_LIGHTS; i++) {
                vec3 L = normalize(pointLights[i].position - fPositionView);
                vec3 lambert = pointLights[i].color * max(dot(L, N), 0.0);
                color += lambert;
            }

            const float NUM_BUCKETS = 4.0;
            vec3 toon = floor(color * NUM_BUCKETS) / NUM_BUCKETS;

            // Try Silhouette Edge Detection
            vec3 V = normalize(-fPositionView); 
            float VN = dot(V, N);

            const float SILHOUETTE_AMOUNT = 0.3;
            const vec3 SILHOUETTE_COLOR = vec3(0.0, 0.0, 0.0);
            float silhouette = 1.0 - step(SILHOUETTE_AMOUNT,  abs(VN));

            color = mix(toon, SILHOUETTE_COLOR, silhouette);

            float wave = 0.5 + 0.5 * sin(time);
            gl_FragColor = vec4(color, 1.0);
        }
        </script>
    </head>
    <body>
        <script src="scripts/three.js"></script>
        <script src="scripts/main.js"></script>
        <script src="scripts/first_person_camera.js"></script>
    </body>
</html>
